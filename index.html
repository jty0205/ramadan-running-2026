<!doctype html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Running + Nutrition 2026 ‚Äî Melesse (35520)</title>

  <style>
    :root{
      --bg:#f4f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --primary:#4f46e5;
      --accent:#f59e0b;
      --ok:#22c55e;
      --warn:#f97316;
      --bad:#ef4444;
      --line:#e5e7eb;
      --shadow:0 10px 25px rgba(0,0,0,.08);
      --radius:18px;
    }
    [data-theme="dark"]{
      --bg:#0b1220;
      --card:#0a1020;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --primary:#6366f1;
      --accent:#fbbf24;
      --line:#1f2937;
      --shadow:0 10px 25px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
      background:var(--bg);
      color:var(--text);
    }

    header{
      padding:18px 16px;
      background:linear-gradient(135deg,var(--primary),var(--accent));
      color:#fff;
    }
    header .title{font-weight:800;font-size:18px}
    header .sub{opacity:.9;margin-top:4px;font-size:12px}

    main{max-width:980px;margin:0 auto;padding:14px}

    .tabs{
      display:flex;gap:8px;flex-wrap:wrap;
      margin:12px 0 14px;
    }
    .tab{
      border:none;
      padding:10px 14px;
      border-radius:999px;
      background:rgba(229,231,235,.9);
      cursor:pointer;
      font-weight:700;
      color:#111827;
    }
    [data-theme="dark"] .tab{background:rgba(31,41,55,.9); color:var(--text)}
    .tab.active{background:var(--primary); color:#fff}

    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:16px;
      box-shadow:var(--shadow);
      border:1px solid var(--line);
      margin-bottom:14px;
    }

    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:12px;
    }

    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px;font-weight:700}
    input, select, textarea{
      width:100%;
      padding:11px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:transparent;
      color:var(--text);
      outline:none;
    }
    textarea{min-height:80px;resize:vertical}

    .small{font-size:12px;color:var(--muted)}
    .kpi{
      display:flex;gap:10px;align-items:center;
      padding:10px 12px;border-radius:14px;border:1px solid var(--line);
      background:rgba(0,0,0,.02);
    }
    [data-theme="dark"] .kpi{background:rgba(255,255,255,.03)}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      border:1px solid var(--line);
      background:rgba(0,0,0,.02);
      font-size:12px;
      color:var(--muted);
    }
    [data-theme="dark"] .pill{background:rgba(255,255,255,.03)}
    .h2{font-size:16px;font-weight:900;margin:0 0 8px}
    .h3{font-size:14px;font-weight:900;margin:0 0 8px}
    .sep{height:1px;background:var(--line);margin:12px 0}

    /* Checklist */
    .checklist{display:flex;flex-direction:column;gap:10px}
    .checkItem{
      display:flex;gap:12px;align-items:flex-start;
      padding:12px;border-radius:16px;border:1px solid var(--line);
      background:rgba(0,0,0,.02);
    }
    [data-theme="dark"] .checkItem{background:rgba(255,255,255,.03)}
    .checkItem input[type="checkbox"]{
      width:22px;height:22px;margin-top:2px;flex:0 0 22px;
      accent-color:var(--primary);
    }
    .checkItem .labelWrap{flex:1}
    .checkItem .labelTitle{font-weight:900}
    .checkItem .labelSub{margin-top:2px;font-size:12px;color:var(--muted);line-height:1.35}

    /* Buttons */
    .btn{
      border:none;cursor:pointer;font-weight:900;
      padding:10px 14px;border-radius:14px;
      background:var(--primary);color:#fff;
    }
    .btn.ghost{
      background:transparent;border:1px solid var(--line);
      color:var(--text);
    }
    .btn.danger{background:var(--bad)}
    .btn.ok{background:var(--ok)}

    .toggle-theme{
      position:fixed;right:16px;bottom:16px;
      border:none;cursor:pointer;font-weight:900;
      padding:14px 16px;border-radius:999px;
      background:var(--primary);color:#fff;
      box-shadow:0 12px 28px rgba(0,0,0,.25);
    }

    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left;font-size:13px}
    th{font-size:12px;color:var(--muted);font-weight:900}

    .mutedBox{
      padding:12px;border-radius:16px;border:1px dashed var(--line);
      color:var(--muted);font-size:12px;line-height:1.45;
    }
  </style>
</head>

<body>
<header>
  <div class="title">Running + Nutrition 2026 ‚Äî Melesse (35520)</div>
  <div class="sub">Suivi quotidien ‚Ä¢ Programme annuel ‚Ä¢ Ramadan (repas + horaires) ‚Ä¢ Objectif mix : perf + perte de poids ‚Ä¢ <span id="appVersion"></span></div>
</header>

<main>
  <div class="tabs">
    <button class="tab active" data-tab="today">Aujourd‚Äôhui</button>
    <button class="tab" data-tab="training">Programme 2026</button>
    <button class="tab" data-tab="ramadan">Ramadan</button>
    <button class="tab" data-tab="goals">Objectifs</button>
    <button class="tab" data-tab="log">Journal</button>
  </div>

  <section id="today" class="panel"></section>
  <section id="training" class="panel" style="display:none"></section>
  <section id="ramadan" class="panel" style="display:none"></section>
  <section id="goals" class="panel" style="display:none"></section>
  <section id="log" class="panel" style="display:none"></section>
</main>

<button class="toggle-theme" id="themeBtn">üåô / ‚òÄÔ∏è</button>

<script>
/* =========================
   VERSION (pour cache-bust)
========================= */
const APP_VERSION = "v2026.02.05-1";
document.getElementById("appVersion").textContent = APP_VERSION;

/* =========================
   STORAGE
========================= */
const store = {
  get(k, d){
    try { return JSON.parse(localStorage.getItem(k)) ?? d; }
    catch(e){ return d; }
  },
  set(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
};

/* =========================
   DEFAULTS (profil + objectifs)
========================= */
const DEFAULTS = {
  profile: {
    birth: "1987-05-02",
    heightCm: 182,
    weightKg: 94
  },
  goals: {
    runsPerWeek: 3,
    // Cibles mix (perte de poids sans flinguer perf)
    waterBaseL: 3.0,
    waterTrainBonusL: 0.4,
    proteinPerKg: 1.6,      // g/kg
    caloriesRest: 2400,     // kcal
    caloriesTrain: 2700,    // kcal
    kneeAlert: 3            // douleur > 3 -> prudence
  }
};

function ensureDefaults(){
  if(!store.get("profile")) store.set("profile", DEFAULTS.profile);
  if(!store.get("goals")) store.set("goals", DEFAULTS.goals);
  if(!store.get("daily")) store.set("daily", {});
  if(!store.get("menu")) store.set("menu", buildMenuWeek()); // menu type
}
ensureDefaults();

/* =========================
   UTIL
========================= */
const z = (n)=>String(n).padStart(2,"0");
function fmtDate(d){ return `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())}`; }
function dayNameFR(d){
  return ["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"][d.getDay()];
}
function weekKey(d){
  const date = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
  const dayNum = date.getUTCDay() || 7;
  date.setUTCDate(date.getUTCDate() + 4 - dayNum);
  const yearStart = new Date(Date.UTC(date.getUTCFullYear(),0,1));
  const weekNo = Math.ceil((((date - yearStart) / 86400000) + 1)/7);
  return `${date.getUTCFullYear()}-W${String(weekNo).padStart(2,'0')}`;
}
function weeksBetween(a, b){
  const ms = 7*24*3600*1000;
  const aa = new Date(a); const bb = new Date(b);
  return Math.floor((bb - aa)/ms);
}
function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }
function round1(n){ return Math.round(n*10)/10; }

/* =========================
   PROGRAMME 2026 (phases)
   - On reste simple et robuste
   - 3 s√©ances/semaine (mix perte de poids + perf)
========================= */
const DATES = {
  start: "2026-02-01",              // d√©marrage du programme
  ramadanStart: "2026-02-19",
  ramadanEnd: "2026-03-20",
  postRamadanEnd: "2026-04-30"
};

function getPhase(dateStr){
  const d = new Date(dateStr);
  const rs = new Date(DATES.ramadanStart);
  const re = new Date(DATES.ramadanEnd);
  const prEnd = new Date(DATES.postRamadanEnd);
  if(d < rs) return "Reprise";
  if(d >= rs && d <= re) return "Ramadan";
  if(d > re && d <= prEnd) return "Post-Ramadan";
  return "Construction 10 km";
}

function getWeekNumberSinceStart(dateStr){
  const start = new Date(DATES.start);
  const d = new Date(dateStr);
  const w = weeksBetween(start, d) + 1;
  return Math.max(1, w);
}

/* =========================
   Prescription course/marche
   => Renvoie un "plan du jour" + objectif s√©ance
========================= */
function getRunPrescription(dateStr){
  const phase = getPhase(dateStr);
  const d = new Date(dateStr);
  const dow = d.getDay(); // 0 dim ... 6 sam
  const weekNo = getWeekNumberSinceStart(dateStr);

  // Jours de s√©ances "par d√©faut" : mar/jeu/sam (2/4/6) => robuste
  const isRunDay = [2,4,6].includes(dow);

  // Progression douce : on augmente les minutes de course continue au fil des semaines
  // Objectif : passer progressivement sur du "continu" puis int√©grer 1 s√©ance un peu plus vive plus tard.
  let easyTotalMin = clamp(30 + Math.floor((weekNo-1)*2), 30, 55); // 30 -> 55
  let runWalk = { runMin: 3, walkMin: 2, rounds: 6 }; // base
  let note = "Rester facile. Tu dois pouvoir parler (souffle contr√¥l√©).";

  if(phase === "Reprise"){
    // 3 s√©ances : marche/course facile + priorit√© genou
    if(isRunDay){
      // progression run:walk
      const step = clamp(weekNo, 1, 8);
      runWalk.runMin = clamp(3 + Math.floor((step-1)/2), 3, 8);   // 3 -> 8
      runWalk.walkMin = clamp(2 - Math.floor((step-1)/4), 1, 2);  // 2 -> 1
      runWalk.rounds = clamp(6 + Math.floor((step-1)/2), 6, 10);  // 6 -> 10
      const total = runWalk.rounds*(runWalk.runMin+runWalk.walkMin);
      return {
        isRunDay:true,
        title:"S√©ance facile (marche/course)",
        detail:`${runWalk.rounds} √ó (${runWalk.runMin} min course + ${runWalk.walkMin} min marche) ‚Äî total ~${total} min`,
        targetMin: total,
        intensity:"Facile",
        note
      };
    }
    return {
      isRunDay:false,
      title:"Repos actif",
      detail:"Marche douce 20‚Äì30 min si envie (mobilit√©).",
      targetMin: 0,
      intensity:"Repos",
      note:"Si genou sensible : mobilit√© + renforcement l√©ger."
    };
  }

  if(phase === "Ramadan"){
    // Objectif : maintenir sans se cramer. S√©ance uniquement apr√®s Iftar.
    if(isRunDay){
      const step = clamp(weekNo, 1, 8);
      const total = clamp(30 + Math.floor((step-1)*2), 30, 45);
      return {
        isRunDay:true,
        title:"Footing doux apr√®s Iftar",
        detail:`${total} min tr√®s facile (ou run/walk si besoin).`,
        targetMin: total,
        intensity:"Tr√®s facile",
        note:"Hydratation + sel l√©ger. Z√©ro s√©ance dure pendant Ramadan."
      };
    }
    return {
      isRunDay:false,
      title:"Repos / mobilit√©",
      detail:"10‚Äì15 min mobilit√© + marche l√©g√®re si envie.",
      targetMin: 0,
      intensity:"Repos",
      note:"Objectif : r√©cup√©ration et sommeil."
    };
  }

  if(phase === "Post-Ramadan"){
    // Reprise progressive du continu
    if(isRunDay){
      const total = clamp(35 + Math.floor((weekNo-1)*2), 35, 55);
      return {
        isRunDay:true,
        title:"Course continue facile",
        detail:`${total} min facile (si besoin : 2 min marche toutes les 10 min).`,
        targetMin: total,
        intensity:"Facile",
        note:"On reconstruit la base. Priorit√© r√©gularit√©."
      };
    }
    return {
      isRunDay:false,
      title:"Repos actif",
      detail:"Marche 20‚Äì30 min ou v√©lo tr√®s doux.",
      targetMin: 0,
      intensity:"Repos",
      note:"Reste mobile, sans fatigue."
    };
  }

  // Construction 10 km (apr√®s fin avril) : 3 s√©ances
  // - Mar: facile
  // - Jeu: un peu plus "rythm√©" (seuil l√©ger) 1x/sem
  // - Sam: sortie un peu plus longue
  if(isRunDay){
    if(dow === 2){
      const total = clamp(40 + Math.floor((weekNo-10)*1), 40, 60);
      return {
        isRunDay:true,
        title:"Facile (base)",
        detail:`${total} min facile`,
        targetMin: total,
        intensity:"Facile",
        note:"Cadence souple, souffle OK."
      };
    }
    if(dow === 4){
      // S√©ance un peu plus rapide introduite progressivement
      const bloc = clamp(10 + Math.floor((weekNo-10)*1), 10, 20);
      return {
        isRunDay:true,
        title:"Rythm√© l√©ger (sans violence)",
        detail:`√âchauff. 10 min facile + ${bloc} min un peu plus vite + retour au calme 10 min`,
        targetMin: 10 + bloc + 10,
        intensity:"Mod√©r√©",
        note:"Tu finis frais. Si genou douteux => s√©ance facile uniquement."
      };
    }
    if(dow === 6){
      const total = clamp(50 + Math.floor((weekNo-10)*2), 50, 80);
      return {
        isRunDay:true,
        title:"Sortie plus longue",
        detail:`${total} min facile (objectif endurance 10 km)`,
        targetMin: total,
        intensity:"Facile",
        note:"Ravitaillement eau si >60 min."
      };
    }
  }
  return {
    isRunDay:false,
    title:"Repos actif",
    detail:"Marche 20‚Äì30 min / mobilit√©.",
    targetMin: 0,
    intensity:"Repos",
    note:"Renforcement genou recommand√©."
  };
}

/* =========================
   HYDRATATION + NUTRITION (mix)
========================= */
function getTargets(dateStr){
  const profile = store.get("profile", DEFAULTS.profile);
  const goals = store.get("goals", DEFAULTS.goals);

  const prescription = getRunPrescription(dateStr);
  const phase = getPhase(dateStr);

  // Eau : base + bonus si entra√Ænement
  const water = round1(goals.waterBaseL + (prescription.isRunDay ? goals.waterTrainBonusL : 0));

  // Prot√©ines : g/kg
  const protein = Math.round(profile.weightKg * goals.proteinPerKg);

  // Calories : plus haut entra√Ænement, plus bas repos
  let calories = prescription.isRunDay ? goals.caloriesTrain : goals.caloriesRest;

  // Ajustement Ramadan : calories un peu moins hautes et focus densit√© nutritionnelle
  if(phase === "Ramadan"){
    calories = Math.round(calories - 150);
  }

  return { waterL: water, proteinG: protein, caloriesKcal: calories };
}

/* =========================
   MENU TYPE (semaine)
   - simple, r√©aliste, r√©p√©table
   - diff√©renci√© repos vs entra√Ænement
========================= */
function buildMenuWeek(){
  // Base : tu peux modifier plus tard
  return {
    trainingDay: {
      breakfast: "Skyr (ou fromage blanc) + flocons d‚Äôavoine + fruits rouges + 1 c√†s beurre de cacahu√®te",
      lunch: "Poulet/thon + riz (ou p√¢tes) + l√©gumes + 1 c√†s huile d‚Äôolive",
      snack: "Whey isolate + banane (ou yaourt) si entra√Ænement",
      dinner: "Omelette (3 ≈ìufs) ou poisson + l√©gumes + pommes de terre"
    },
    restDay: {
      breakfast: "≈íufs + pain complet + fruit (ou skyr + fruits)",
      lunch: "Steak hach√© 5%/dinde + l√©gumes + quinoa/lentilles",
      snack: "Skyr / fromage blanc + poign√©e d‚Äôamandes",
      dinner: "Poisson/volaille + gros volume de l√©gumes + f√©culent l√©ger"
    },
    ramadan: {
      suhoor: "Flocons d‚Äôavoine + skyr + banane + eau + pinc√©e de sel",
      iftar: "Eau + 2‚Äì3 dattes + soupe + source de prot√©ines",
      dinner: "Plat complet : prot√©ines + l√©gumes + f√©culent (portion ma√Ætris√©e)"
    }
  };
}

function getMenuForDay(dateStr){
  const phase = getPhase(dateStr);
  const menu = store.get("menu", buildMenuWeek());
  const presc = getRunPrescription(dateStr);
  if(phase === "Ramadan") return { type:"ramadan", ...menu.ramadan };
  return presc.isRunDay ? { type:"trainingDay", ...menu.trainingDay } : { type:"restDay", ...menu.restDay };
}

/* =========================
   DAILY STATE
========================= */
function getDaily(dateStr){
  const all = store.get("daily", {});
  return all[dateStr] || {
    hydrationOk:false,
    runOk:false,
    strengthOk:false,
    foodOk:false,
    waterReal:"",
    proteinReal:"",
    caloriesReal:"",
    runMin:"",
    runKm:"",
    knee:"",
    energy:"",
    notes:""
  };
}
function setDaily(dateStr, st){
  const all = store.get("daily", {});
  all[dateStr] = st;
  store.set("daily", all);
}

/* =========================
   WEEK SUMMARY
========================= */
function sumWeek(dateStr){
  const all = store.get("daily", {});
  const target = new Date(dateStr);
  const wk = weekKey(target);

  let km=0, min=0, runs=0, kneeMax=0;
  for(const [d, st] of Object.entries(all)){
    const dd = new Date(d);
    if(weekKey(dd) !== wk) continue;
    const k = parseFloat(st.runKm);
    const m = parseFloat(st.runMin);
    if(!isNaN(k)) km += k;
    if(!isNaN(m)) min += m;
    if((st.runKm && !isNaN(k)) || (st.runMin && !isNaN(m))) runs += 1;
    const kk = parseFloat(st.knee);
    if(!isNaN(kk)) kneeMax = Math.max(kneeMax, kk);
  }
  return { wk, km: round1(km), min: Math.round(min), runs, kneeMax };
}

/* =========================
   RENDER ‚Äî TODAY
========================= */
function renderToday(){
  const root = document.getElementById("today");
  const today = fmtDate(new Date());
  const st = getDaily(today);
  const phase = getPhase(today);
  const weekNo = getWeekNumberSinceStart(today);
  const presc = getRunPrescription(today);
  const targets = getTargets(today);
  const menu = getMenuForDay(today);

  const goals = store.get("goals", DEFAULTS.goals);
  const w = sumWeek(today);

  // ids for labels (accessibilit√© + alignement)
  const ids = {
    hydration:"chk_hydration",
    run:"chk_run",
    strength:"chk_strength",
    food:"chk_food"
  };

  root.innerHTML = `
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="h2">Semaine ${weekNo} ‚Äî ${phase}</div>
          <div class="small">${dayNameFR(new Date(today))} ‚Ä¢ Date : <b>${today}</b> ‚Ä¢ Mode : <b>mix perf + perte de poids</b></div>
        </div>
        <div class="pill">üìå ${presc.intensity} ‚Ä¢ ${presc.title}</div>
      </div>

      <div class="sep"></div>

      <div class="grid">
        <div class="kpi">
          <div style="font-size:18px">‚úÖ</div>
          <div>
            <div style="font-weight:900">Plan du jour</div>
            <div class="small">${presc.detail}</div>
            <div class="small" style="margin-top:4px">${presc.note}</div>
          </div>
        </div>

        <div class="kpi">
          <div style="font-size:18px">üíß</div>
          <div>
            <div style="font-weight:900">Eau cible</div>
            <div class="small"><b>${targets.waterL} L / jour</b> (base ${goals.waterBaseL} + bonus ${presc.isRunDay ? goals.waterTrainBonusL : 0})</div>
          </div>
        </div>

        <div class="kpi">
          <div style="font-size:18px">üçó</div>
          <div>
            <div style="font-weight:900">Nutrition cible</div>
            <div class="small"><b>Prot√©ines : ${targets.proteinG} g</b> ‚Ä¢ <b>Calories : ${targets.caloriesKcal} kcal</b></div>
            <div class="small">${phase==="Ramadan" ? "Ramadan : densit√© nutritionnelle + hydratation entre Iftar et Suhoor." : "Jour entra√Ænement = un peu plus de calories pour progresser."}</div>
          </div>
        </div>
      </div>

      <div class="sep"></div>

      <div class="h3">Tableau de bord (semaine en cours)</div>
      <div class="small">Semaine : <b>${w.wk}</b> ‚Äî Sorties : <b>${w.runs}/${goals.runsPerWeek}</b> ‚Äî km : <b>${w.km}</b> ‚Äî minutes : <b>${w.min}</b></div>
      ${w.kneeMax > goals.kneeAlert ? `<div class="small" style="margin-top:6px;color:var(--bad);font-weight:900">‚ö†Ô∏è Genou : douleur max semaine = ${w.kneeMax} (> ${goals.kneeAlert}) ‚áí s√©ance facile uniquement + renforcement.</div>` : ``}
    </div>

    <div class="card">
      <div class="h2">Check-list du jour</div>
      <div class="checklist">
        <div class="checkItem">
          <input id="${ids.hydration}" type="checkbox" ${st.hydrationOk ? "checked":""}>
          <div class="labelWrap">
            <div class="labelTitle">Hydratation</div>
            <div class="labelSub">Objectif : <b>${targets.waterL} L</b> aujourd‚Äôhui (saisis ton r√©el plus bas).</div>
          </div>
        </div>

        <div class="checkItem">
          <input id="${ids.run}" type="checkbox" ${st.runOk ? "checked":""}>
          <div class="labelWrap">
            <div class="labelTitle">Course / Marche</div>
            <div class="labelSub">${presc.isRunDay ? `Aujourd‚Äôhui : <b>${presc.detail}</b>` : `Aujourd‚Äôhui : <b>${presc.detail}</b>`}</div>
          </div>
        </div>

        <div class="checkItem">
          <input id="${ids.strength}" type="checkbox" ${st.strengthOk ? "checked":""}>
          <div class="labelWrap">
            <div class="labelTitle">Renforcement genou</div>
            <div class="labelSub">2√ó/semaine (1√ó si fatigue Ramadan). Focus : gainage + fessiers + mollets + mobilit√©.</div>
          </div>
        </div>

        <div class="checkItem">
          <input id="${ids.food}" type="checkbox" ${st.foodOk ? "checked":""}>
          <div class="labelWrap">
            <div class="labelTitle">Alimentation (prot√©ines + calories)</div>
            <div class="labelSub">Cible : <b>${targets.proteinG} g</b> prot√©ines ‚Ä¢ <b>${targets.caloriesKcal} kcal</b> (saisis ton r√©el plus bas).</div>
          </div>
        </div>
      </div>

      <div class="sep"></div>

      <div class="h3">Menu type du jour (${menu.type === "ramadan" ? "Ramadan" : (menu.type === "trainingDay" ? "Jour entra√Ænement" : "Jour repos")})</div>
      ${menu.type==="ramadan" ? `
        <div class="grid">
          <div><div class="pill">üåô Suhoor</div><div class="small" style="margin-top:6px">${menu.suhoor}</div></div>
          <div><div class="pill">üåÖ Iftar</div><div class="small" style="margin-top:6px">${menu.iftar}</div></div>
          <div><div class="pill">üçΩÔ∏è D√Æner</div><div class="small" style="margin-top:6px">${menu.dinner}</div></div>
        </div>
      ` : `
        <div class="grid">
          <div><div class="pill">‚òÄÔ∏è Petit-d√©j</div><div class="small" style="margin-top:6px">${menu.breakfast}</div></div>
          <div><div class="pill">ü•ó D√©j</div><div class="small" style="margin-top:6px">${menu.lunch}</div></div>
          <div><div class="pill">üçå Collation</div><div class="small" style="margin-top:6px">${menu.snack}</div></div>
          <div><div class="pill">üåô D√Æner</div><div class="small" style="margin-top:6px">${menu.dinner}</div></div>
        </div>
      `}
    </div>

    <div class="card">
      <div class="h2">Suivi du jour (saisie)</div>
      <div class="grid">
        <div>
          <label>Eau r√©elle (L)</label>
          <input id="waterReal" type="number" min="0" step="0.1" value="${st.waterReal}">
        </div>
        <div>
          <label>Prot√©ines r√©elles (g)</label>
          <input id="proteinReal" type="number" min="0" step="1" value="${st.proteinReal}">
        </div>
        <div>
          <label>Calories r√©elles (kcal)</label>
          <input id="caloriesReal" type="number" min="0" step="10" value="${st.caloriesReal}">
        </div>

        <div>
          <label>Dur√©e course (min)</label>
          <input id="runMin" type="number" min="0" step="1" value="${st.runMin}">
        </div>
        <div>
          <label>Distance (km)</label>
          <input id="runKm" type="number" min="0" step="0.01" value="${st.runKm}">
        </div>
        <div>
          <label>Douleur genou (0‚Äì10)</label>
          <input id="knee" type="number" min="0" max="10" step="1" value="${st.knee}">
        </div>
        <div>
          <label>√ânergie (0‚Äì10)</label>
          <input id="energy" type="number" min="0" max="10" step="1" value="${st.energy}">
        </div>
        <div style="grid-column:1/-1">
          <label>Notes</label>
          <textarea id="notes">${st.notes || ""}</textarea>
        </div>
      </div>

      <div class="row" style="margin-top:12px;justify-content:space-between">
        <button class="btn ok" id="saveBtn">Enregistrer</button>
        <button class="btn danger" id="resetBtn">R√©initialiser la journ√©e</button>
      </div>

      <div class="small" style="margin-top:10px">Les donn√©es restent sur ton t√©l√©phone/ordinateur (localStorage). Pas d‚Äôinscription.</div>
    </div>
  `;

  // Bind checklist
  const bindChk = (id, key) => {
    const el = document.getElementById(id);
    el.addEventListener("change", (e)=>{
      st[key] = e.target.checked;
      setDaily(today, st);
    });
  };
  bindChk(ids.hydration, "hydrationOk");
  bindChk(ids.run, "runOk");
  bindChk(ids.strength, "strengthOk");
  bindChk(ids.food, "foodOk");

  // Save/Reset
  document.getElementById("saveBtn").onclick = ()=>{
    st.waterReal = document.getElementById("waterReal").value;
    st.proteinReal = document.getElementById("proteinReal").value;
    st.caloriesReal = document.getElementById("caloriesReal").value;
    st.runMin = document.getElementById("runMin").value;
    st.runKm = document.getElementById("runKm").value;
    st.knee = document.getElementById("knee").value;
    st.energy = document.getElementById("energy").value;
    st.notes = document.getElementById("notes").value;
    setDaily(today, st);
    alert("‚úÖ Enregistr√© !");
  };

  document.getElementById("resetBtn").onclick = ()=>{
    if(!confirm("R√©initialiser les donn√©es du jour ?")) return;
    setDaily(today, {
      hydrationOk:false, runOk:false, strengthOk:false, foodOk:false,
      waterReal:"", proteinReal:"", caloriesReal:"",
      runMin:"", runKm:"", knee:"", energy:"", notes:""
    });
    renderToday();
  };
}

/* =========================
   RENDER ‚Äî PROGRAMME 2026
========================= */
function renderTraining(){
  const root = document.getElementById("training");
  const today = fmtDate(new Date());
  const phase = getPhase(today);
  const weekNo = getWeekNumberSinceStart(today);

  root.innerHTML = `
    <div class="card">
      <div class="h2">Programme 2026 (3 s√©ances/semaine)</div>
      <div class="small">Aujourd‚Äôhui : <b>Semaine ${weekNo}</b> ‚Ä¢ Phase : <b>${phase}</b></div>

      <div class="sep"></div>

      <div class="mutedBox">
        <b>Principe du mix :</b><br>
        ‚Ä¢ Perte de poids : r√©gularit√© + calories ma√Ætris√©es les jours repos.<br>
        ‚Ä¢ Performance : calories un peu plus hautes les jours entra√Ænement, + progression douce, + 1 s√©ance ‚Äúrythm√©e l√©ger‚Äù plus tard.<br>
        ‚Ä¢ Genou : si douleur > seuil ‚áí s√©ance facile uniquement + renforcement.
      </div>
    </div>

    <div class="card">
      <div class="h3">Structure type (mar / jeu / sam)</div>
      <table>
        <thead><tr><th>Jour</th><th>Objectif</th><th>Contenu</th></tr></thead>
        <tbody>
          <tr><td>Mardi</td><td>Base</td><td>Facile (marche/course puis continu)</td></tr>
          <tr><td>Jeudi</td><td>Progression</td><td>Facile / puis ‚Äúrythm√© l√©ger‚Äù quand pr√™t</td></tr>
          <tr><td>Samedi</td><td>Endurance</td><td>Sortie plus longue facile</td></tr>
        </tbody>
      </table>
      <div class="small" style="margin-top:10px">L‚Äôapp calcule automatiquement le <b>plan du jour</b> selon la semaine et la phase.</div>
    </div>
  `;
}

/* =========================
   RENDER ‚Äî RAMADAN
========================= */
const RAMADAN_SCHEDULE = [
  {"day":1,"date":"2026-02-19","fajr":"06:41","maghrib":"18:38","fasting":"11h57"},
  {"day":2,"date":"2026-02-20","fajr":"06:39","maghrib":"18:40","fasting":"12h01"},
  {"day":3,"date":"2026-02-21","fajr":"06:37","maghrib":"18:41","fasting":"12h04"},
  {"day":4,"date":"2026-02-22","fajr":"06:36","maghrib":"18:43","fasting":"12h07"},
  {"day":5,"date":"2026-02-23","fajr":"06:34","maghrib":"18:44","fasting":"12h10"},
  {"day":6,"date":"2026-02-24","fajr":"06:32","maghrib":"18:46","fasting":"12h14"},
  {"day":7,"date":"2026-02-25","fajr":"06:30","maghrib":"18:48","fasting":"12h18"},
  {"day":8,"date":"2026-02-26","fajr":"06:29","maghrib":"18:49","fasting":"12h20"},
  {"day":9,"date":"2026-02-27","fajr":"06:27","maghrib":"18:51","fasting":"12h24"},
  {"day":10,"date":"2026-02-28","fajr":"06:25","maghrib":"18:52","fasting":"12h27"},
  {"day":11,"date":"2026-03-01","fajr":"06:23","maghrib":"18:54","fasting":"12h31"},
  {"day":12,"date":"2026-03-02","fajr":"06:21","maghrib":"18:55","fasting":"12h34"},
  {"day":13,"date":"2026-03-03","fajr":"06:19","maghrib":"18:57","fasting":"12h38"},
  {"day":14,"date":"2026-03-04","fajr":"06:17","maghrib":"18:58","fasting":"12h41"},
  {"day":15,"date":"2026-03-05","fajr":"06:15","maghrib":"19:00","fasting":"12h45"},
  {"day":16,"date":"2026-03-06","fajr":"06:13","maghrib":"19:01","fasting":"12h48"},
  {"day":17,"date":"2026-03-07","fajr":"06:11","maghrib":"19:03","fasting":"12h52"},
  {"day":18,"date":"2026-03-08","fajr":"06:09","maghrib":"19:05","fasting":"12h56"},
  {"day":19,"date":"2026-03-09","fajr":"06:07","maghrib":"19:06","fasting":"12h59"},
  {"day":20,"date":"2026-03-10","fajr":"06:05","maghrib":"19:08","fasting":"13h03"},
  {"day":21,"date":"2026-03-11","fajr":"06:03","maghrib":"19:09","fasting":"13h06"},
  {"day":22,"date":"2026-03-12","fajr":"06:01","maghrib":"19:11","fasting":"13h10"},
  {"day":23,"date":"2026-03-13","fajr":"05:59","maghrib":"19:12","fasting":"13h13"},
  {"day":24,"date":"2026-03-14","fajr":"05:57","maghrib":"19:14","fasting":"13h17"},
  {"day":25,"date":"2026-03-15","fajr":"05:55","maghrib":"19:15","fasting":"13h20"},
  {"day":26,"date":"2026-03-16","fajr":"05:52","maghrib":"19:17","fasting":"13h25"},
  {"day":27,"date":"2026-03-17","fajr":"05:50","maghrib":"19:18","fasting":"13h28"},
  {"day":28,"date":"2026-03-18","fajr":"05:48","maghrib":"19:19","fasting":"13h31"},
  {"day":29,"date":"2026-03-19","fajr":"05:46","maghrib":"19:21","fasting":"13h35"},
  {"day":30,"date":"2026-03-20","fajr":"05:44","maghrib":"19:22","fasting":"13h38"}
];

function renderRamadan(){
  const root = document.getElementById("ramadan");
  root.innerHTML = `
    <div class="card">
      <div class="h2">Ramadan 2026 ‚Äî Melesse</div>
      <div class="small">Suhoor = Fajr ‚Ä¢ Iftar = Maghrib ‚Ä¢ Entra√Ænement : apr√®s Iftar uniquement (footing doux).</div>
    </div>

    <div class="card">
      <table>
        <thead><tr><th>Jour</th><th>Date</th><th>Fajr (Suhoor)</th><th>Maghrib (Iftar)</th><th>Dur√©e</th></tr></thead>
        <tbody>
          ${RAMADAN_SCHEDULE.map(r=>`
            <tr>
              <td>${r.day}</td>
              <td>${r.date}</td>
              <td>${r.fajr}</td>
              <td>${r.maghrib}</td>
              <td>${r.fasting}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    </div>
  `;
}

/* =========================
   RENDER ‚Äî OBJECTIFS / PROFIL
========================= */
function renderGoals(){
  const root = document.getElementById("goals");
  const profile = store.get("profile", DEFAULTS.profile);
  const goals = store.get("goals", DEFAULTS.goals);
  const menu = store.get("menu", buildMenuWeek());

  root.innerHTML = `
    <div class="card">
      <div class="h2">Profil</div>
      <div class="grid">
        <div><label>Date de naissance</label><input id="birth" type="date" value="${profile.birth}"></div>
        <div><label>Taille (cm)</label><input id="height" type="number" min="120" max="220" value="${profile.heightCm}"></div>
        <div><label>Poids (kg)</label><input id="weight" type="number" min="40" max="200" value="${profile.weightKg}"></div>
      </div>
      <div class="small" style="margin-top:10px">Le poids sert √† calculer automatiquement ta cible prot√©ines.</div>
    </div>

    <div class="card">
      <div class="h2">Objectifs (mix perf + perte de poids)</div>
      <div class="grid">
        <div><label>Sorties / semaine</label><input id="runs" type="number" min="1" max="7" value="${goals.runsPerWeek}"></div>
        <div><label>Eau base (L/jour)</label><input id="waterBase" type="number" min="1" max="6" step="0.1" value="${goals.waterBaseL}"></div>
        <div><label>Bonus eau jour entra√Ænement (L)</label><input id="waterBonus" type="number" min="0" max="2" step="0.1" value="${goals.waterTrainBonusL}"></div>
        <div><label>Prot√©ines (g/kg)</label><input id="ppk" type="number" min="1.2" max="2.2" step="0.1" value="${goals.proteinPerKg}"></div>
        <div><label>Calories jour repos (kcal)</label><input id="calRest" type="number" min="1500" max="4000" step="50" value="${goals.caloriesRest}"></div>
        <div><label>Calories jour entra√Ænement (kcal)</label><input id="calTrain" type="number" min="1600" max="4500" step="50" value="${goals.caloriesTrain}"></div>
        <div><label>Seuil alerte genou (0‚Äì10)</label><input id="kneeAlert" type="number" min="0" max="10" step="1" value="${goals.kneeAlert}"></div>
      </div>

      <div class="row" style="margin-top:12px;justify-content:space-between">
        <button class="btn ok" id="saveGoals">Enregistrer</button>
        <button class="btn ghost" id="resetDefaults">Remettre valeurs par d√©faut</button>
      </div>
    </div>

    <div class="card">
      <div class="h2">Menus type (modifiable)</div>
      <div class="small">Tu peux personnaliser ici. L‚Äôapp affichera automatiquement ‚Äújour entra√Ænement‚Äù ou ‚Äújour repos‚Äù, et ‚ÄúRamadan‚Äù.</div>
      <div class="sep"></div>

      <div class="h3">Jour entra√Ænement</div>
      <div class="grid">
        <div><label>Petit-d√©j</label><textarea id="m_tb">${menu.trainingDay.breakfast}</textarea></div>
        <div><label>D√©jeuner</label><textarea id="m_tl">${menu.trainingDay.lunch}</textarea></div>
        <div><label>Collation</label><textarea id="m_ts">${menu.trainingDay.snack}</textarea></div>
        <div><label>D√Æner</label><textarea id="m_td">${menu.trainingDay.dinner}</textarea></div>
      </div>

      <div class="sep"></div>

      <div class="h3">Jour repos</div>
      <div class="grid">
        <div><label>Petit-d√©j</label><textarea id="m_rb">${menu.restDay.breakfast}</textarea></div>
        <div><label>D√©jeuner</label><textarea id="m_rl">${menu.restDay.lunch}</textarea></div>
        <div><label>Collation</label><textarea id="m_rs">${menu.restDay.snack}</textarea></div>
        <div><label>D√Æner</label><textarea id="m_rd">${menu.restDay.dinner}</textarea></div>
      </div>

      <div class="sep"></div>

      <div class="h3">Ramadan</div>
      <div class="grid">
        <div><label>Suhoor</label><textarea id="m_su">${menu.ramadan.suhoor}</textarea></div>
        <div><label>Iftar</label><textarea id="m_if">${menu.ramadan.iftar}</textarea></div>
        <div><label>D√Æner</label><textarea id="m_ra">${menu.ramadan.dinner}</textarea></div>
      </div>

      <div class="row" style="margin-top:12px;justify-content:space-between">
        <button class="btn ok" id="saveMenu">Enregistrer menus</button>
        <button class="btn ghost" id="resetMenu">R√©initialiser menus</button>
      </div>
    </div>
  `;

  document.getElementById("saveGoals").onclick = ()=>{
    const p = {
      birth: document.getElementById("birth").value,
      heightCm: Number(document.getElementById("height").value || DEFAULTS.profile.heightCm),
      weightKg: Number(document.getElementById("weight").value || DEFAULTS.profile.weightKg)
    };
    store.set("profile", p);

    const g = {
      runsPerWeek: Number(document.getElementById("runs").value || DEFAULTS.goals.runsPerWeek),
      waterBaseL: Number(document.getElementById("waterBase").value || DEFAULTS.goals.waterBaseL),
      waterTrainBonusL: Number(document.getElementById("waterBonus").value || DEFAULTS.goals.waterTrainBonusL),
      proteinPerKg: Number(document.getElementById("ppk").value || DEFAULTS.goals.proteinPerKg),
      caloriesRest: Number(document.getElementById("calRest").value || DEFAULTS.goals.caloriesRest),
      caloriesTrain: Number(document.getElementById("calTrain").value || DEFAULTS.goals.caloriesTrain),
      kneeAlert: Number(document.getElementById("kneeAlert").value || DEFAULTS.goals.kneeAlert)
    };
    store.set("goals", g);

    alert("‚úÖ Profil + objectifs enregistr√©s");
    renderToday();
  };

  document.getElementById("resetDefaults").onclick = ()=>{
    if(!confirm("Remettre les objectifs par d√©faut ?")) return;
    store.set("profile", DEFAULTS.profile);
    store.set("goals", DEFAULTS.goals);
    renderGoals();
    renderToday();
  };

  document.getElementById("saveMenu").onclick = ()=>{
    const m = {
      trainingDay:{
        breakfast: document.getElementById("m_tb").value,
        lunch: document.getElementById("m_tl").value,
        snack: document.getElementById("m_ts").value,
        dinner: document.getElementById("m_td").value
      },
      restDay:{
        breakfast: document.getElementById("m_rb").value,
        lunch: document.getElementById("m_rl").value,
        snack: document.getElementById("m_rs").value,
        dinner: document.getElementById("m_rd").value
      },
      ramadan:{
        suhoor: document.getElementById("m_su").value,
        iftar: document.getElementById("m_if").value,
        dinner: document.getElementById("m_ra").value
      }
    };
    store.set("menu", m);
    alert("‚úÖ Menus enregistr√©s");
    renderToday();
  };

  document.getElementById("resetMenu").onclick = ()=>{
    if(!confirm("R√©initialiser les menus ?")) return;
    store.set("menu", buildMenuWeek());
    renderGoals();
    renderToday();
  };
}

/* =========================
   RENDER ‚Äî JOURNAL
========================= */
function renderLog(){
  const root = document.getElementById("log");
  const all = store.get("daily", {});
  const rows = Object.entries(all).sort((a,b)=>a[0].localeCompare(b[0])).reverse().slice(0, 120);

  root.innerHTML = `
    <div class="card">
      <div class="h2">Journal</div>
      <div class="small">Derni√®res entr√©es (max 120).</div>
    </div>

    <div class="card">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Eau (L)</th>
            <th>Prot (g)</th>
            <th>Kcal</th>
            <th>Min</th>
            <th>Km</th>
            <th>Genou</th>
            <th>√ânergie</th>
          </tr>
        </thead>
        <tbody>
          ${rows.map(([d,st])=>`
            <tr>
              <td>${d}</td>
              <td>${st.waterReal || ""}</td>
              <td>${st.proteinReal || ""}</td>
              <td>${st.caloriesReal || ""}</td>
              <td>${st.runMin || ""}</td>
              <td>${st.runKm || ""}</td>
              <td>${st.knee || ""}</td>
              <td>${st.energy || ""}</td>
            </tr>
          `).join("")}
        </tbody>
      </table>
    </div>
  `;
}

/* =========================
   NAVIGATION
========================= */
function show(tabId){
  document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
  document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add("active");

  document.querySelectorAll(".panel").forEach(p=>p.style.display="none");
  document.getElementById(tabId).style.display="block";

  if(tabId==="today") renderToday();
  if(tabId==="training") renderTraining();
  if(tabId==="ramadan") renderRamadan();
  if(tabId==="goals") renderGoals();
  if(tabId==="log") renderLog();
}
document.querySelectorAll(".tab").forEach(b=>b.onclick=()=>show(b.dataset.tab));

/* =========================
   THEME (persistant)
========================= */
function setTheme(t){
  document.documentElement.setAttribute("data-theme", t);
  store.set("theme", t);
}
function toggleTheme(){
  const cur = document.documentElement.getAttribute("data-theme") || "light";
  setTheme(cur==="dark" ? "light" : "dark");
}
document.getElementById("themeBtn").onclick = toggleTheme;

const savedTheme = store.get("theme", "light");
setTheme(savedTheme);

/* =========================
   INIT
========================= */
renderToday();
</script>
</body>
</html>

