<!doctype html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ramadan + Running + Nutrition 2026 ‚Äî Melesse (35520)</title>
  <style>
    :root{
      --bg:#f4f7fb; --card:#ffffff; --text:#111827; --muted:#6b7280;
      --primary:#4f46e5; --accent:#f59e0b; --ok:#22c55e; --warn:#ef4444;
      --shadow:0 10px 25px rgba(0,0,0,.08);
      --border:rgba(17,24,39,.10);
    }
    [data-theme="dark"]{
      --bg:#0b1224; --card:#060b18; --text:#e5e7eb; --muted:#9ca3af;
      --primary:#6366f1; --accent:#fbbf24; --ok:#22c55e; --warn:#fb7185;
      --shadow:0 10px 25px rgba(0,0,0,.35);
      --border:rgba(229,231,235,.10);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
      background:var(--bg); color:var(--text);
    }
    header{
      padding:18px 16px;
      background:linear-gradient(135deg,var(--primary),var(--accent));
      color:#fff;
    }
    header .title{font-weight:800;font-size:18px;line-height:1.2}
    header .sub{opacity:.9;font-size:12px;margin-top:4px}
    main{padding:16px;max-width:980px;margin:auto}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0 16px}
    .tab{
      border:none;border-radius:999px;padding:10px 14px;
      font-weight:700;cursor:pointer;background:rgba(0,0,0,.08); color:inherit;
    }
    [data-theme="dark"] .tab{background:rgba(255,255,255,.10)}
    .tab.active{background:var(--primary);color:#fff}
    .card{
      background:var(--card); border-radius:18px; padding:16px;
      box-shadow:var(--shadow); margin-bottom:14px; border:1px solid var(--border);
    }
    .small{font-size:12px;color:var(--muted)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:12px;
      background:rgba(79,70,229,.08); border:1px solid rgba(79,70,229,.25);
      font-weight:700;
    }
    [data-theme="dark"] .pill{background:rgba(99,102,241,.15);border-color:rgba(99,102,241,.28)}
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:12px;
      margin-top:10px;
    }
    label{display:block;font-size:12px;color:var(--muted);margin:0 0 4px}
    input, select, textarea{
      width:100%; padding:10px 10px; border-radius:12px;
      border:1px solid var(--border); background:transparent; color:inherit;
      outline:none;
    }
    textarea{min-height:90px; resize:vertical}
    .check{
      display:flex; align-items:flex-start; gap:10px;
      padding:10px; border-radius:14px;
      background:rgba(0,0,0,.03); border:1px solid var(--border);
      margin:10px 0;
    }
    [data-theme="dark"] .check{background:rgba(255,255,255,.06)}
    .check input{width:20px;height:20px;margin-top:2px}
    .check .meta{font-size:12px;color:var(--muted);margin-top:3px}
    .btn{
      border:none;border-radius:12px;padding:10px 12px;
      font-weight:800; cursor:pointer;
    }
    .btn.primary{background:var(--primary);color:#fff}
    .btn.ghost{background:transparent;border:1px solid var(--border);color:inherit}
    .btn.danger{background:#ef4444;color:#fff}
    .toggle-theme{
      position:fixed; right:18px; bottom:18px;
      background:var(--primary); color:#fff; border:none;
      border-radius:999px; padding:14px 16px; font-weight:900;
      box-shadow:0 10px 25px rgba(0,0,0,.25); cursor:pointer;
    }
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
    th{font-size:12px;color:var(--muted)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px}
    .hr{height:1px;background:var(--border);margin:12px 0}
  </style>
</head>

<body>
<header>
  <div class="title">Ramadan + Running + Nutrition 2026 ‚Äî Melesse (35520)</div>
  <div class="sub">Suivi quotidien (offline) ‚Ä¢ Programme 2026 (3 s√©ances/sem) ‚Ä¢ Eau / Prot√©ines / Calories ‚Ä¢ Mode clair/sombre ‚Ä¢ v3</div>
</header>

<main>
  <div class="tabs">
    <button class="tab active" data-tab="today">Aujourd‚Äôhui</button>
    <button class="tab" data-tab="training">Entra√Ænement</button>
    <button class="tab" data-tab="nutrition">Nutrition</button>
    <button class="tab" data-tab="ramadan">Ramadan</button>
    <button class="tab" data-tab="log">Journal</button>
    <button class="tab" data-tab="settings">Objectifs</button>
  </div>

  <section id="today" class="panel"></section>
  <section id="training" class="panel" style="display:none"></section>
  <section id="nutrition" class="panel" style="display:none"></section>
  <section id="ramadan" class="panel" style="display:none"></section>
  <section id="log" class="panel" style="display:none"></section>
  <section id="settings" class="panel" style="display:none"></section>
</main>

<button class="toggle-theme" onclick="toggleTheme()">üåô / ‚òÄÔ∏è</button>

<script>
/* =========================
   CONFIG ‚Äî PERSONNEL
========================= */
const APP_VERSION = "v3.0.0";
const PROFILE_DEFAULTS = {
  name: "JT",
  birth: "1987-05-02",
  heightCm: 182,
  weightKg: 94
};

/* Objectifs de d√©part (tu peux modifier dans ‚ÄúObjectifs‚Äù) */
const GOALS_DEFAULTS = {
  runsPerWeek: 3,
  kneeAlert: 4,               // si douleur genou >= 4 => on l√®ve le pied
  waterL: 3.3,                // L / jour (cible)
  proteinG: 152,              // g / jour (cible)
  caloriesTraining: 2850,     // kcal jour entra√Ænement (cible)
  caloriesRest: 2450          // kcal jour repos (cible)
};

/* Ramadan 2026 ‚Äî Melesse (35520) (extrait complet) */
const RAMADAN_2026 = [
  {"day":1,"date":"2026-02-19","fajr":"06:41","maghrib":"18:38","fasting":"11h57"},
  {"day":2,"date":"2026-02-20","fajr":"06:39","maghrib":"18:40","fasting":"12h01"},
  {"day":3,"date":"2026-02-21","fajr":"06:37","maghrib":"18:41","fasting":"12h04"},
  {"day":4,"date":"2026-02-22","fajr":"06:36","maghrib":"18:43","fasting":"12h07"},
  {"day":5,"date":"2026-02-23","fajr":"06:34","maghrib":"18:44","fasting":"12h10"},
  {"day":6,"date":"2026-02-24","fajr":"06:32","maghrib":"18:46","fasting":"12h14"},
  {"day":7,"date":"2026-02-25","fajr":"06:30","maghrib":"18:48","fasting":"12h18"},
  {"day":8,"date":"2026-02-26","fajr":"06:29","maghrib":"18:49","fasting":"12h20"},
  {"day":9,"date":"2026-02-27","fajr":"06:27","maghrib":"18:51","fasting":"12h24"},
  {"day":10,"date":"2026-02-28","fajr":"06:25","maghrib":"18:52","fasting":"12h27"},
  {"day":11,"date":"2026-03-01","fajr":"06:23","maghrib":"18:54","fasting":"12h31"},
  {"day":12,"date":"2026-03-02","fajr":"06:21","maghrib":"18:55","fasting":"12h34"},
  {"day":13,"date":"2026-03-03","fajr":"06:19","maghrib":"18:57","fasting":"12h38"},
  {"day":14,"date":"2026-03-04","fajr":"06:17","maghrib":"18:58","fasting":"12h41"},
  {"day":15,"date":"2026-03-05","fajr":"06:15","maghrib":"19:00","fasting":"12h45"},
  {"day":16,"date":"2026-03-06","fajr":"06:13","maghrib":"19:01","fasting":"12h48"},
  {"day":17,"date":"2026-03-07","fajr":"06:11","maghrib":"19:03","fasting":"12h52"},
  {"day":18,"date":"2026-03-08","fajr":"06:09","maghrib":"19:05","fasting":"12h56"},
  {"day":19,"date":"2026-03-09","fajr":"06:07","maghrib":"19:06","fasting":"12h59"},
  {"day":20,"date":"2026-03-10","fajr":"06:05","maghrib":"19:08","fasting":"13h03"},
  {"day":21,"date":"2026-03-11","fajr":"06:03","maghrib":"19:09","fasting":"13h06"},
  {"day":22,"date":"2026-03-12","fajr":"06:01","maghrib":"19:11","fasting":"13h10"},
  {"day":23,"date":"2026-03-13","fajr":"05:59","maghrib":"19:12","fasting":"13h13"},
  {"day":24,"date":"2026-03-14","fajr":"05:57","maghrib":"19:14","fasting":"13h17"},
  {"day":25,"date":"2026-03-15","fajr":"05:55","maghrib":"19:15","fasting":"13h20"},
  {"day":26,"date":"2026-03-16","fajr":"05:52","maghrib":"19:17","fasting":"13h25"},
  {"day":27,"date":"2026-03-17","fajr":"05:50","maghrib":"19:18","fasting":"13h28"},
  {"day":28,"date":"2026-03-18","fajr":"05:48","maghrib":"19:19","fasting":"13h31"},
  {"day":29,"date":"2026-03-19","fajr":"05:46","maghrib":"19:21","fasting":"13h35"},
  {"day":30,"date":"2026-03-20","fajr":"05:44","maghrib":"19:22","fasting":"13h38"}
];

/* Renforcement genou (simple, efficace) */
const KNEE_FRIENDLY = [
  {name:"Gainage face", sets:3, reps:"30‚Äì45 s"},
  {name:"Gainage lat√©ral", sets:2, reps:"30 s / c√¥t√©"},
  {name:"Pont fessier", sets:3, reps:"15‚Äì20"},
  {name:"Mollets debout lents", sets:3, reps:"20"},
  {name:"Squat lent (amplitude contr√¥l√©e)", sets:3, reps:"10‚Äì12"}
];

/* =========================
   STORAGE (anti-crash)
========================= */
const store = {
  get(k, d){
    try{
      const v = JSON.parse(localStorage.getItem(k));
      return (v === null || v === undefined) ? d : v;
    }catch(e){ return d; }
  },
  set(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
};

function ensureDefaults(){
  if(!store.get("profile", null)) store.set("profile", PROFILE_DEFAULTS);
  if(!store.get("goals", null)) store.set("goals", GOALS_DEFAULTS);
  if(!store.get("daily", null)) store.set("daily", {});
  if(!store.get("log", null)) store.set("log", []);
}
ensureDefaults();

/* =========================
   HELPERS
========================= */
const z = n => String(n).padStart(2,"0");
function fmtDate(d){
  return `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())}`;
}
function parseDate(s){ const [Y,M,D]=s.split("-").map(Number); return new Date(Y, M-1, D); }
function daysBetween(a,b){ return Math.round((b - a) / 86400000); }

function el(tag, attrs={}, html=""){
  const n = document.createElement(tag);
  Object.entries(attrs).forEach(([k,v])=>{
    if(k==="class") n.className=v;
    else if(k.startsWith("on")) n.addEventListener(k.slice(2), v);
    else n.setAttribute(k, v);
  });
  if(html!==null && html!==undefined) n.innerHTML = html;
  return n;
}

function getDaily(dateStr){
  const all = store.get("daily", {});
  return all[dateStr] || {
    // checklist
    chkHydration:false, chkRun:false, chkStrength:false, chkFood:false,
    // saisies
    waterL:"", proteinG:"", caloriesK:"", runMin:"", runKm:"", walkMin:"", knee:"", energy:"", notes:"",
    // tags
    mode:"A" // A = normal, B = plus doux
  };
}
function setDaily(dateStr, obj){
  const all = store.get("daily", {});
  all[dateStr] = obj;
  store.set("daily", all);
}
function pushLog(line){
  const l = store.get("log", []);
  l.unshift(line);
  store.set("log", l.slice(0, 250));
}

/* =========================
   PROGRAMME 2026 (simple et solide)
   - Reprise : 4 semaines (3 s√©ances, run/walk)
   - Pr√©-Ramadan : mont√©e progressive
   - Ramadan : 2‚Äì3 s√©ances max, tr√®s doux, apr√®s Iftar
   - Post-Ramadan : reprise progressive vers 10 km
========================= */
function getPhase(dateStr){
  const d = parseDate(dateStr);
  const ramStart = parseDate("2026-02-19");
  const ramEnd   = parseDate("2026-03-20");

  if(d < ramStart) return "Reprise";
  if(d >= ramStart && d <= ramEnd) return "Ramadan";
  if(d <= parseDate("2026-04-30")) return "Post-Ramadan";
  return "Objectif 10 km";
}

function weekNumberSince(startStr, dateStr){
  const s = parseDate(startStr);
  const d = parseDate(dateStr);
  const diffDays = Math.max(0, daysBetween(s, d));
  return Math.floor(diffDays/7) + 1;
}

/* Donne le plan du jour (course + marche) selon phase, semaine, et jour */
function planOfDay(dateStr){
  const goals = store.get("goals", GOALS_DEFAULTS);
  const phase = getPhase(dateStr);
  const d = parseDate(dateStr);
  const dow = d.getDay(); // 0 dim, 1 lun... 6 sam

  // Jours ‚Äútype‚Äù : Mar / Jeu / Dim = s√©ances (3)
  const isSessionDay = [2,4,0].includes(dow);
  const isStrengthDay = [1,5].includes(dow); // Lun/Ven renfo l√©ger

  // Mode B si genou au-dessus du seuil (la veille ou saisie du jour)
  const st = getDaily(dateStr);
  const knee = parseFloat(st.knee);
  const kneeAlert = goals.kneeAlert ?? 4;
  const mode = (isNaN(knee) ? st.mode : (knee >= kneeAlert ? "B" : st.mode));

  // Base
  let run = { targetRunMin: 0, targetWalkMin: 0, text: "" };
  let sessionsPerWeek = goals.runsPerWeek || 3;

  // Si pas journ√©e de s√©ance, on met repos / marche douce
  if(!isSessionDay){
    run.targetRunMin = 0;
    run.targetWalkMin = (phase==="Ramadan") ? 0 : 20; // marche douce option hors ramadan
    run.text = (phase==="Ramadan")
      ? "Repos (ou mobilit√© douce 10‚Äì15 min)."
      : "Repos / marche douce 20 min si envie.";
    return {phase, mode, sessionsPerWeek, isSessionDay:false, isStrengthDay, run};
  }

  // S√©ances selon phases
  if(phase==="Reprise"){
    const wk = weekNumberSince("2026-01-01", dateStr); // rep√®re simple
    // 3 s√©ances : 35‚Äì60 min total en run/walk
    const total = Math.min(60, 35 + (wk-1)*5); // prog douce
    // Mode B = plus de marche
    const runPart = (mode==="B") ? 12 : 18;
    run.targetRunMin = runPart;
    run.targetWalkMin = Math.max(0, total - runPart);
    run.text = `S√©ance Reprise : alternance course/marche ‚Äî total ${total} min (course ${runPart} min + marche ${total-runPart} min).`;
    return {phase, mode, sessionsPerWeek, isSessionDay:true, isStrengthDay, run};
  }

  if(phase==="Ramadan"){
    // Tr√®s doux, apr√®s Iftar. 25‚Äì40 min total.
    const total = (mode==="B") ? 25 : 35;
    const runPart = (mode==="B") ? 12 : 20;
    run.targetRunMin = runPart;
    run.targetWalkMin = total - runPart;
    run.text = `Ramadan : footing tr√®s doux apr√®s Iftar ‚Äî ${total} min (course ${runPart} + marche ${total-runPart}).`;
    return {phase, mode, sessionsPerWeek: Math.min(3, sessionsPerWeek), isSessionDay:true, isStrengthDay, run};
  }

  if(phase==="Post-Ramadan"){
    // Reprise progressive vers 45‚Äì60 min, run/walk si besoin
    const wk = weekNumberSince("2026-03-21", dateStr);
    const total = Math.min(60, 40 + (wk-1)*5);
    const runPart = (mode==="B") ? Math.min(24, 14 + (wk-1)*2) : Math.min(35, 18 + (wk-1)*3);
    run.targetRunMin = runPart;
    run.targetWalkMin = Math.max(0, total - runPart);
    run.text = `Post-Ramadan : progression douce ‚Äî ${total} min (course ${runPart} + marche ${total-runPart}).`;
    return {phase, mode, sessionsPerWeek, isSessionDay:true, isStrengthDay, run};
  }

  // Objectif 10 km : course continue + allures tr√®s progressives
  // pour toi : rester ‚Äúfacile‚Äù tant que le poids baisse et que la r√©gularit√© s‚Äôinstalle
  const wk = weekNumberSince("2026-05-01", dateStr);
  const total = Math.min(70, 45 + (wk-1)*3);
  const runPart = (mode==="B") ? Math.min(40, 25 + (wk-1)*2) : Math.min(60, 35 + (wk-1)*3);
  run.targetRunMin = runPart;
  run.targetWalkMin = Math.max(0, total - runPart);
  run.text = `Objectif 10 km : endurance facile ‚Äî ${total} min (course ${runPart} + marche ${total-runPart}).`;
  return {phase, mode, sessionsPerWeek, isSessionDay:true, isStrengthDay, run};
}

/* =========================
   NUTRITION ‚Äî cibles simples
========================= */
function targetsForDay(dateStr){
  const goals = store.get("goals", GOALS_DEFAULTS);
  const p = planOfDay(dateStr);
  const isTraining = p.isSessionDay;
  const water = goals.waterL ?? 3.3;
  const protein = goals.proteinG ?? 152;
  const calories = isTraining ? (goals.caloriesTraining ?? 2850) : (goals.caloriesRest ?? 2450);
  return { isTraining, waterL: water, proteinG: protein, caloriesK: calories };
}

function mealTemplate(isTraining, phase){
  // menus types (simples, ‚Äúr√©p√©tables‚Äù, pas de cuisine compliqu√©e)
  if(phase==="Ramadan"){
    return {
      title:"Menu type Ramadan (simple)",
      lines:[
        "Suhoor : eau + yaourt grec/skyr + flocons d‚Äôavoine + fruit + 30‚Äì40 g whey si besoin.",
        "Iftar : eau + 2‚Äì3 dattes + soupe/l√©gumes + source prot√©ines (poulet/poisson/≈ìufs) + f√©culent mod√©r√©.",
        "D√Æner : l√©ger, prot√©ines + l√©gumes, √©viter le gras lourd.",
        "Hydratation : √©taler de l‚ÄôIftar au Suhoor (objectif eau)."
      ]
    };
  }
  if(isTraining){
    return {
      title:"Menu type jour entra√Ænement",
      lines:[
        "Petit-d√©j : prot√©ines + glucides simples (ex : ≈ìufs + pain complet) + fruit.",
        "D√©j : prot√©ines + f√©culent + l√©gumes (portion f√©culent un peu plus large).",
        "Collation : whey + fruit (si faim / si s√©ance).",
        "D√Æner : prot√©ines + l√©gumes + un peu de f√©culents si besoin."
      ]
    };
  }
  return {
    title:"Menu type jour repos",
    lines:[
      "Petit-d√©j : prot√©ines + fruit.",
      "D√©j : prot√©ines + l√©gumes + f√©culent plus petit.",
      "Collation : skyr/yaourt + fruit (option).",
      "D√Æner : prot√©ines + l√©gumes (simple)."
    ]
  };
}

/* =========================
   UI ‚Äî RENDER
========================= */
function renderToday(){
  const root = document.getElementById("today");
  const dateStr = fmtDate(new Date());
  const st = getDaily(dateStr);
  const goals = store.get("goals", GOALS_DEFAULTS);
  const prof = store.get("profile", PROFILE_DEFAULTS);

  const p = planOfDay(dateStr);
  const t = targetsForDay(dateStr);
  const ram = RAMADAN_2026.find(x=>x.date===dateStr);

  root.innerHTML = "";
  const top = el("div", {class:"card"}, `
    <div class="row" style="justify-content:space-between">
      <div>
        <div style="font-weight:900;font-size:16px">Semaine ‚Äî ${p.phase}</div>
        <div class="small">Date : <span class="mono">${dateStr}</span> ‚Ä¢ Mode : <b>${p.mode}</b> (A = normal, B = plus doux)</div>
      </div>
      <div class="small mono">APP ${APP_VERSION}</div>
    </div>
    <div class="hr"></div>
    <div class="row" style="gap:8px">
      <span class="pill">‚úÖ Plan du jour : <b>${p.run.text}</b></span>
    </div>
    <div class="row" style="margin-top:10px">
      <span class="pill">üíß Eau cible : <b>${t.waterL.toFixed(1)} L / jour</b></span>
      <span class="pill">üçó Prot√©ines : <b>${t.proteinG} g</b></span>
      <span class="pill">üî• Calories : <b>${t.caloriesK} kcal</b> (${t.isTraining ? "entra√Ænement" : "repos"})</span>
    </div>
    ${ram ? `<div class="small" style="margin-top:10px">Ramadan ‚Äî Suhoor(Fajr) : <b>${ram.fajr}</b> ‚Ä¢ Iftar(Maghrib) : <b>${ram.maghrib}</b> ‚Ä¢ Dur√©e : <b>${ram.fasting}</b></div>` : `<div class="small" style="margin-top:10px">Hors Ramadan ‚Äî 3 s√©ances/semaine (progression douce).</div>`}
  `);
  root.appendChild(top);

  // Checklist
  const chk = el("div", {class:"card"});
  chk.appendChild(el("div", {}, `<div style="font-weight:900;font-size:16px">Check-list du jour</div><div class="small">La check-list s‚Äôadapte au plan du jour (course/marche + cibles nutrition).</div>`));

  const mkCheck = (key, title, meta) => {
    const wrap = el("div", {class:"check"});
    const input = el("input", {type:"checkbox"});
    input.checked = !!st[key];
    input.addEventListener("change", (e)=>{
      st[key] = e.target.checked;
      setDaily(dateStr, st);
      pushLog(`${dateStr} ‚Ä¢ ${title} : ${st[key] ? "OK" : "NON"}`);
      renderToday(); // refresh
    });
    const content = el("div", {}, `<div style="font-weight:800">${title}</div><div class="meta">${meta}</div>`);
    wrap.appendChild(input); wrap.appendChild(content);
    return wrap;
  };

  chk.appendChild(mkCheck("chkHydration", "Hydratation", `Objectif : ${t.waterL.toFixed(1)} L aujourd‚Äôhui (saisis ton r√©el plus bas).`));
  chk.appendChild(mkCheck("chkRun", "Course / Marche", p.isSessionDay
    ? `Cible : course ${p.run.targetRunMin} min + marche ${p.run.targetWalkMin} min (total ${p.run.targetRunMin + p.run.targetWalkMin} min).`
    : `Repos. Option : marche douce ${p.run.targetWalkMin} min.`));
  chk.appendChild(mkCheck("chkStrength", "Renforcement genou", `2√ó/semaine (1√ó si fatigue Ramadan). Focus gainage + fessiers + mollets.`));
  chk.appendChild(mkCheck("chkFood", "Alimentation (prot√©ines + calories)", `Cible : ${t.proteinG} g prot√©ines ‚Ä¢ ${t.caloriesK} kcal.`));

  const quickMeals = mealTemplate(t.isTraining, p.phase);
  chk.appendChild(el("div", {class:"small", style:"margin-top:10px"}, `
    <b>Repas (rappel rapide)</b><br>
    <b>${quickMeals.title}</b><br>
    ‚Ä¢ ${quickMeals.lines.join("<br>‚Ä¢ ")}
  `));
  root.appendChild(chk);

  // Saisie jour
  const form = el("div", {class:"card"});
  form.appendChild(el("div", {}, `<div style="font-weight:900;font-size:16px">Suivi du jour (saisie)</div><div class="small">Les donn√©es restent sur ton t√©l√©phone/ordi (localStorage). Pas d‚Äôinscription.</div>`));

  const grid = el("div", {class:"grid"});
  const field = (lab, key, type="number", step=null, placeholder="") => {
    const box = el("div", {});
    box.appendChild(el("label", {}, lab));
    const inp = el("input", {type, placeholder});
    if(step!==null) inp.setAttribute("step", step);
    inp.value = st[key] ?? "";
    inp.addEventListener("input", (e)=>{ st[key] = e.target.value; setDaily(dateStr, st); });
    box.appendChild(inp);
    return box;
  };

  grid.appendChild(field("Eau r√©elle (L)", "waterL", "number", "0.1", `Cible ${t.waterL.toFixed(1)}`));
  grid.appendChild(field("Prot√©ines r√©elles (g)", "proteinG", "number", "1", `Cible ${t.proteinG}`));
  grid.appendChild(field("Calories r√©elles (kcal)", "caloriesK", "number", "1", `Cible ${t.caloriesK}`));
  grid.appendChild(field("Dur√©e course (min)", "runMin", "number", "1", `Cible ${p.run.targetRunMin}`));
  grid.appendChild(field("Distance (km)", "runKm", "number", "0.01", ""));
  grid.appendChild(field("Dur√©e marche (min)", "walkMin", "number", "1", `Cible ${p.run.targetWalkMin}`));
  grid.appendChild(field("Douleur genou (0‚Äì10)", "knee", "number", "1", `Alerte ‚â• ${goals.kneeAlert}`));
  grid.appendChild(field("√ânergie (0‚Äì10)", "energy", "number", "1", ""));

  form.appendChild(grid);

  const notesBox = el("div", {style:"margin-top:12px"});
  notesBox.appendChild(el("label", {}, "Notes"));
  const ta = el("textarea", {});
  ta.value = st.notes || "";
  ta.addEventListener("input", (e)=>{ st.notes = e.target.value; setDaily(dateStr, st); });
  notesBox.appendChild(ta);
  form.appendChild(notesBox);

  const actions = el("div", {class:"row", style:"margin-top:12px"});
  const btnSave = el("button", {class:"btn primary"}, "Enregistrer");
  btnSave.addEventListener("click", ()=>{
    setDaily(dateStr, st);
    pushLog(`${dateStr} ‚Ä¢ Sauvegarde : eau=${st.waterL||"-"}L, prot=${st.proteinG||"-"}g, kcal=${st.caloriesK||"-"}, run=${st.runMin||"-"}min/${st.runKm||"-"}km, walk=${st.walkMin||"-"}min, genou=${st.knee||"-"}, √©nergie=${st.energy||"-"}`);
    alert("‚úÖ Enregistr√©.");
  });

  const btnReset = el("button", {class:"btn danger"}, "R√©initialiser la journ√©e");
  btnReset.addEventListener("click", ()=>{
    if(!confirm("Tu confirmes ? √áa efface les saisies du jour.")) return;
    const fresh = getDaily("2099-01-01"); // clone structure
    setDaily(dateStr, fresh);
    pushLog(`${dateStr} ‚Ä¢ Reset journ√©e`);
    renderToday();
  });

  actions.appendChild(btnSave);
  actions.appendChild(btnReset);
  form.appendChild(actions);

  const hint = el("div", {class:"small", style:"margin-top:10px"}, `
    Astuce : si tu ne vois pas les changements apr√®s un commit GitHub Pages, fais un <b>hard refresh</b> (Cmd+Shift+R) ou ouvre en navigation priv√©e.
  `);
  form.appendChild(hint);

  root.appendChild(form);
}

function renderTraining(){
  const root = document.getElementById("training");
  const dateStr = fmtDate(new Date());
  const p = planOfDay(dateStr);
  const goals = store.get("goals", GOALS_DEFAULTS);

  root.innerHTML = "";
  root.appendChild(el("div", {class:"card"}, `
    <div style="font-weight:900;font-size:16px">Entra√Ænement ‚Äî guide simple</div>
    <div class="small">Objectif : r√©gularit√©, genou OK, progression douce. Si genou ‚â• ${goals.kneeAlert} ‚Üí Mode B + marche.</div>
    <div class="hr"></div>
    <div class="row">
      <span class="pill">Phase : <b>${p.phase}</b></span>
      <span class="pill">S√©ances/sem : <b>${p.sessionsPerWeek}</b></span>
      <span class="pill">Aujourd‚Äôhui : <b>${p.isSessionDay ? "S√©ance" : "Repos"}</b></span>
    </div>
  `));

  root.appendChild(el("div", {class:"card"}, `
    <div style="font-weight:900">S√©ances (3 / semaine) ‚Äî structure</div>
    <div class="small" style="margin-top:6px">
      <b>Mardi :</b> endurance facile (run/walk si besoin)<br>
      <b>Jeudi :</b> endurance facile (m√™me logique)<br>
      <b>Dimanche :</b> sortie un peu plus longue (toujours facile)
    </div>
    <div class="hr"></div>
    <div class="small">
      <b>Quand tu passeras sous 7‚Äô00/km ‚Äúsans forcer‚Äù ?</b><br>
      Pour ton profil (d√©but + 94 kg), c‚Äôest surtout la r√©gularit√© + perte de poids qui font tout. En g√©n√©ral : <b>6 √† 12 semaines</b> de constance suffisent pour sentir un vrai saut.
      <br><br>
      <b>Quand introduire une s√©ance plus rapide ?</b><br>
      Pas avant d‚Äôavoir : <b>6 semaines</b> r√©guli√®res, genou ‚â§ 3/10, et une sortie facile o√π tu finis frais. √Ä ce moment-l√† : 1 s√©ance/sem ‚Äúacc√©l√©rations courtes‚Äù (20‚Äì30 s) au lieu d‚Äôintervalles durs.
    </div>
  `));

  // Renfo
  const renfo = el("div", {class:"card"});
  renfo.appendChild(el("div", {}, `<div style="font-weight:900">Renforcement genou (r√©f√©rence)</div><div class="small">2√ó/semaine (1√ó si fatigue Ramadan). 15‚Äì20 min.</div>`));
  const table = el("table", {});
  table.innerHTML = `
    <thead><tr><th>Exercice</th><th>S√©ries √ó R√©p√©titions</th></tr></thead>
    <tbody>
      ${KNEE_FRIENDLY.map(x=>`<tr><td>${x.name}</td><td>${x.sets} √ó ${x.reps}</td></tr>`).join("")}
    </tbody>
  `;
  renfo.appendChild(table);
  root.appendChild(renfo);
}

function renderNutrition(){
  const root = document.getElementById("nutrition");
  const dateStr = fmtDate(new Date());
  const t = targetsForDay(dateStr);
  const phase = getPhase(dateStr);
  const prof = store.get("profile", PROFILE_DEFAULTS);

  const tpl = mealTemplate(t.isTraining, phase);

  root.innerHTML = "";
  root.appendChild(el("div", {class:"card"}, `
    <div style="font-weight:900;font-size:16px">Nutrition ‚Äî cibles du jour</div>
    <div class="small">Simple, r√©p√©table, efficace. L‚Äôobjectif : perdre du poids sans flinguer l‚Äô√©nergie.</div>
    <div class="hr"></div>
    <div class="row">
      <span class="pill">üíß Eau : <b>${t.waterL.toFixed(1)} L</b></span>
      <span class="pill">üçó Prot√©ines : <b>${t.proteinG} g</b></span>
      <span class="pill">üî• Calories : <b>${t.caloriesK} kcal</b> (${t.isTraining ? "entra√Ænement" : "repos"})</span>
    </div>
  `));

  root.appendChild(el("div", {class:"card"}, `
    <div style="font-weight:900">${tpl.title}</div>
    <div class="small" style="margin-top:8px">‚Ä¢ ${tpl.lines.join("<br>‚Ä¢ ")}</div>
    <div class="hr"></div>
    <div class="small">
      <b>Point cl√© pour toi :</b> vise la cible prot√©ines tous les jours. C‚Äôest ce qui prot√®ge la masse musculaire et acc√©l√®re la recomposition.
      <br><br>
      <b>Whey isolate :</b> utile si tu n‚Äôatteins pas la cible prot√©ines. 30‚Äì40 g apr√®s s√©ance ou en collation.
    </div>
  `));

  root.appendChild(el("div", {class:"card"}, `
    <div style="font-weight:900">Quand la progression s‚Äôacc√©l√®re ‚Äúvraiment‚Äù ?</div>
    <div class="small" style="margin-top:8px">
      Chez la plupart des gens, le ‚Äúd√©clic‚Äù se ressent quand tu enl√®ves ~<b>6 √† 10 kg</b> (moins de charge sur les articulations, allure plus facile √† FC identique).
      <br><br>
      Pour ton objectif 10 km : un poids r√©aliste et tr√®s rentable, c‚Äôest <b>86‚Äì88 kg</b> (tu auras un gain net sans te cramer).
    </div>
  `));
}

function renderRamadan(){
  const root = document.getElementById("ramadan");
  const dateStr = fmtDate(new Date());
  const today = RAMADAN_2026.find(x=>x.date===dateStr);

  root.innerHTML = "";
  root.appendChild(el("div", {class:"card"}, `
    <div style="font-weight:900;font-size:16px">Ramadan 2026 ‚Äî Melesse (35520)</div>
    <div class="small">R√®gle simple : entra√Ænement <b>apr√®s Iftar</b> uniquement (doux).</div>
    ${today ? `<div class="hr"></div><div class="row">
      <span class="pill">Aujourd‚Äôhui : <b>${today.date}</b></span>
      <span class="pill">Fajr : <b>${today.fajr}</b></span>
      <span class="pill">Maghrib : <b>${today.maghrib}</b></span>
      <span class="pill">Dur√©e : <b>${today.fasting}</b></span>
    </div>` : ""}
  `));

  const table = el("div", {class:"card"});
  table.appendChild(el("div", {}, `<div style="font-weight:900">Table compl√®te</div><div class="small">Suhoor = Fajr ‚Ä¢ Iftar = Maghrib</div>`));
  const t = el("table", {});
  t.innerHTML = `
    <thead><tr><th>Jour</th><th>Date</th><th>Fajr</th><th>Maghrib</th><th>Dur√©e</th></tr></thead>
    <tbody>
      ${RAMADAN_2026.map(r=>`<tr><td>${r.day}</td><td class="mono">${r.date}</td><td>${r.fajr}</td><td>${r.maghrib}</td><td>${r.fasting}</td></tr>`).join("")}
    </tbody>
  `;
  table.appendChild(t);
  root.appendChild(table);
}

function renderLog(){
  const root = document.getElementById("log");
  const logs = store.get("log", []);
  const all = store.get("daily", {});
  const rows = Object.entries(all).sort((a,b)=>b[0].localeCompare(a[0])).slice(0, 60);

  root.innerHTML = "";
  root.appendChild(el("div", {class:"card"}, `
    <div style="font-weight:900;font-size:16px">Journal</div>
    <div class="small">Historique des actions + derni√®res saisies (60 jours affich√©s).</div>
  `));

  const table = el("div", {class:"card"});
  table.appendChild(el("div", {}, `<div style="font-weight:900">Derni√®res saisies</div>`));
  const t = el("table", {});
  t.innerHTML = `
    <thead>
      <tr>
        <th>Date</th><th>Eau</th><th>Prot</th><th>Kcal</th><th>Run</th><th>Km</th><th>Marche</th><th>Genou</th><th>√ânergie</th>
      </tr>
    </thead>
    <tbody>
      ${rows.map(([d,st])=>`
        <tr>
          <td class="mono">${d}</td>
          <td>${st.waterL||""}</td>
          <td>${st.proteinG||""}</td>
          <td>${st.caloriesK||""}</td>
          <td>${st.runMin||""}</td>
          <td>${st.runKm||""}</td>
          <td>${st.walkMin||""}</td>
          <td>${st.knee||""}</td>
          <td>${st.energy||""}</td>
        </tr>
      `).join("")}
    </tbody>
  `;
  table.appendChild(t);
  root.appendChild(table);

  const list = el("div", {class:"card"});
  list.appendChild(el("div", {}, `<div style="font-weight:900">Logs (actions)</div><div class="small">250 entr√©es max.</div>`));
  list.appendChild(el("div", {class:"small", style:"margin-top:10px;line-height:1.6"}, logs.slice(0,80).map(x=>`‚Ä¢ ${x}`).join("<br>") || "Aucun log."));
  root.appendChild(list);
}

function renderSettings(){
  const root = document.getElementById("settings");
  const prof = store.get("profile", PROFILE_DEFAULTS);
  const goals = store.get("goals", GOALS_DEFAULTS);

  root.innerHTML = "";
  root.appendChild(el("div", {class:"card"}, `
    <div style="font-weight:900;font-size:16px">Objectifs</div>
    <div class="small">Tu peux tout ajuster ici. C‚Äôest ce qui pilote les cibles (eau/prot√©ines/kcal) et les alertes genou.</div>
  `));

  const card = el("div", {class:"card"});
  card.appendChild(el("div", {}, `<div style="font-weight:900">Profil</div>`));
  const grid = el("div", {class:"grid"});

  const profFields = [
    ["Nom", "name", "text"],
    ["Date de naissance (YYYY-MM-DD)", "birth", "text"],
    ["Taille (cm)", "heightCm", "number"],
    ["Poids (kg)", "weightKg", "number"],
  ];

  profFields.forEach(([lab,key,type])=>{
    const box = el("div", {});
    box.appendChild(el("label", {}, lab));
    const inp = el("input", {type});
    inp.value = prof[key] ?? "";
    inp.addEventListener("input", e=>{ prof[key] = (type==="number") ? Number(e.target.value||0) : e.target.value; store.set("profile", prof); });
    box.appendChild(inp);
    grid.appendChild(box);
  });

  card.appendChild(grid);
  root.appendChild(card);

  const gcard = el("div", {class:"card"});
  gcard.appendChild(el("div", {}, `<div style="font-weight:900">Cibles</div>`));
  const ggrid = el("div", {class:"grid"});

  const goalFields = [
    ["S√©ances / semaine", "runsPerWeek"],
    ["Seuil alerte genou (0‚Äì10)", "kneeAlert"],
    ["Eau cible (L / jour)", "waterL"],
    ["Prot√©ines cibles (g / jour)", "proteinG"],
    ["Calories jour entra√Ænement (kcal)", "caloriesTraining"],
    ["Calories jour repos (kcal)", "caloriesRest"],
  ];

  goalFields.forEach(([lab,key])=>{
    const box = el("div", {});
    box.appendChild(el("label", {}, lab));
    const inp = el("input", {type:"number"});
    inp.value = goals[key] ?? "";
    inp.addEventListener("input", e=>{ goals[key] = Number(e.target.value||0); store.set("goals", goals); });
    box.appendChild(inp);
    ggrid.appendChild(box);
  });

  gcard.appendChild(ggrid);

  const actions = el("div", {class:"row", style:"margin-top:12px"});
  const b1 = el("button", {class:"btn primary"}, "Sauvegarder");
  b1.addEventListener("click", ()=>{
    store.set("profile", prof);
    store.set("goals", goals);
    pushLog(`${fmtDate(new Date())} ‚Ä¢ MAJ objectifs : eau=${goals.waterL}, prot=${goals.proteinG}, kcalTrain=${goals.caloriesTraining}, kcalRest=${goals.caloriesRest}, kneeAlert=${goals.kneeAlert}`);
    alert("‚úÖ Objectifs enregistr√©s.");
    renderToday();
  });

  const b2 = el("button", {class:"btn ghost"}, "R√©glages par d√©faut");
  b2.addEventListener("click", ()=>{
    if(!confirm("Tu confirmes ? √áa remet les objectifs par d√©faut.")) return;
    store.set("goals", GOALS_DEFAULTS);
    pushLog(`${fmtDate(new Date())} ‚Ä¢ Reset objectifs`);
    renderSettings();
    renderToday();
  });

  actions.appendChild(b1); actions.appendChild(b2);
  gcard.appendChild(actions);
  root.appendChild(gcard);

  root.appendChild(el("div", {class:"card"}, `
    <div style="font-weight:900">Important (GitHub Pages)</div>
    <div class="small" style="margin-top:8px">
      Si tu modifies le fichier et que tu ne vois rien : <b>Cmd+Shift+R</b> (hard refresh) ou navigation priv√©e.
      <br>Et v√©rifie que tu modifies bien <b>main / (root) / index.html</b>.
    </div>
  `));
}

/* =========================
   NAVIGATION
========================= */
function show(tab){
  document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
  const btn = document.querySelector(`.tab[data-tab="${tab}"]`);
  if(btn) btn.classList.add("active");

  ["today","training","nutrition","ramadan","log","settings"].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.style.display = (id===tab) ? "block" : "none";
  });

  const map = {
    today: renderToday,
    training: renderTraining,
    nutrition: renderNutrition,
    ramadan: renderRamadan,
    log: renderLog,
    settings: renderSettings
  };
  (map[tab] || renderToday)();
}

document.querySelectorAll(".tab").forEach(b=>{
  b.addEventListener("click", ()=>show(b.dataset.tab));
});

/* =========================
   THEME + PERSISTENCE
========================= */
function toggleTheme(){
  const cur = document.documentElement.getAttribute("data-theme") || "light";
  const next = (cur==="dark") ? "light" : "dark";
  document.documentElement.setAttribute("data-theme", next);
  store.set("theme", next);
}
(function initTheme(){
  const saved = store.get("theme", "light");
  document.documentElement.setAttribute("data-theme", saved);
})();

/* INIT */
show("today");
</script>
</body>
</html>


</body>
</html>
